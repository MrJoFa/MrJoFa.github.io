<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Sokoban â€“ Julgransversion med hinder</title>
<style>
body {
    background:#222; 
    color:white; 
    font-family:Arial; 
    text-align:center;
}
#game {
    margin:20px auto;
    display:grid;
    grid-template-columns: repeat(10, 40px);
    gap:2px;
}
.tile {
    width:40px; height:40px;
    display:flex; 
    justify-content:center; 
    align-items:center;
    font-size:24px;
}
.wall { background:#444; }
.player { background:#3a6; }
.box { background:#c96; }
.goal { background:#66f; }
.box.goal { background:#0f0; }
</style>
</head>
<body>

<h1>ðŸŽ„ Sokoban â€“ Julgransutmaning ðŸŽ„</h1>
<p>AnvÃ¤nd piltangenterna fÃ¶r att spela</p>

<div id="game"></div>
<h2 id="leveltext"></h2>

<script>
// ----------------------------------------------------
// NivÃ¥er med hinder och mÃ¥l
// # = vÃ¤gg
// P = spelare
// B = lÃ¥da
// G = mÃ¥l
// " " = tomt
// ----------------------------------------------------
let levels = [
[
"##########",
"#P   #   #",
"# B  # G #",
"#    #   #",
"#   B    #",
"##########"
],
[
"##########",
"#  P  #  #",
"# B##   G#",
"#   B  # #",
"#  B     #",
"##########"
],
[
"##########",
"# P  ##  #",
"# B  B G #",
"#   ##   #",
"#  B     #",
"##########"
],
[
"##########",
"# P  ##  #",
"# B  B G #",
"#   ##  G#",
"# B    B #",
"##########"
]
];

let grid = [];
let player = {x:0, y:0};
let boxes = [];
let goals = [];
let level = 0;

startLevel(level);

// ----------------------------------------------------
// Starta nivÃ¥
// ----------------------------------------------------
function startLevel(n){
    grid = levels[n].map(row => row.split(''));
    boxes = [];
    goals = [];

    for(let y=0; y<grid.length; y++){
        for(let x=0; x<grid[y].length; x++){
            if(grid[y][x]=='P') player={x,y};
            if(grid[y][x]=='B') boxes.push({x,y});
            if(grid[y][x]=='G') goals.push({x,y});
        }
    }

    document.getElementById("leveltext").textContent = "NivÃ¥ " + (n+1);
    draw();
}

// ----------------------------------------------------
// Tangenter
// ----------------------------------------------------
document.addEventListener("keydown", e=>{
    let dx=0, dy=0;
    if(e.key==="ArrowUp") dy=-1;
    if(e.key==="ArrowDown") dy=1;
    if(e.key==="ArrowLeft") dx=-1;
    if(e.key==="ArrowRight") dx=1;
    movePlayer(dx,dy);
});

// ----------------------------------------------------
// Flytta spelare med hinder
// ----------------------------------------------------
function movePlayer(dx,dy){
    let nx = player.x + dx;
    let ny = player.y + dy;

    if(!inside(nx,ny)) return;
    if(grid[ny][nx]=='#') return;

    let box = boxes.find(b=>b.x===nx && b.y===ny);
    if(box){
        let bx = box.x + dx;
        let by = box.y + dy;
        if(!inside(bx,by)) return;
        if(grid[by][bx]=='#') return;
        if(boxes.some(b=>b.x===bx && b.y===by)) return;
        box.x = bx;
        box.y = by;
    }

    player.x = nx;
    player.y = ny;

    checkWin();
    draw();
}

// ----------------------------------------------------
// Kolla om inom grÃ¤ns
// ----------------------------------------------------
function inside(x,y){
    return y>=0 && y<grid.length && x>=0 && x<grid[y].length;
}

// ----------------------------------------------------
// Rita spelplan
// ----------------------------------------------------
function draw(){
    let div = document.getElementById("game");
    div.innerHTML = "";
    let html = "";

    for(let y=0; y<grid.length; y++){
        for(let x=0; x<grid[y].length; x++){
            let cls="tile";
            let emoji="";
            let c = grid[y][x];

            if(c=='#') { cls+=" wall"; emoji="ðŸŸ«"; }
            if(player.x===x && player.y===y){ cls+=" player"; emoji="ðŸ˜€"; }
            let box = boxes.find(b=>b.x===x && b.y===y);
            if(box){ cls+=" box"; emoji="ðŸ§±"; }
            let goal = goals.find(g=>g.x===x && g.y===y);
            if(goal){ cls+=" goal"; if(box) emoji="ðŸ’š"; else emoji="ðŸŽ¯"; }

            html += `<div class="${cls}">${emoji}</div>`;
        }
    }
    div.innerHTML = html;
}

// ----------------------------------------------------
// Kolla om alla mÃ¥l Ã¤r uppfyllda
// ----------------------------------------------------
function checkWin(){
    let done = boxes.every(b=>goals.some(g=>g.x===b.x && g.y===b.y));
    if(done){
        level++;
        if(level<levels.length){
            setTimeout(()=>startLevel(level), 500);
        } else {
            document.getElementById("leveltext").textContent="ðŸŽ‰ Snyggt jobbat ni klarade det! ðŸŽ‰";
        }
    }
}
</script>

</body>
</html>
