<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Minesweeper 9x9</title>
<style>
body {
  font-family: sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
  background-color: #f5f5f5;
}

h1 {
  color: #333;
}

#header {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 10px;
}

#timer, #minesLeft {
  font-size: 20px;
  font-weight: bold;
}

#reset {
  font-size: 28px;
  cursor: pointer;
  user-select: none;
}

#board {
  display: grid;
  grid-template-columns: repeat(9, 40px);
  grid-gap: 4px;
}

.cell {
  width: 40px;
  height: 40px;
  background-color: #ccc;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  font-weight: bold;
  user-select: none;
  border-radius: 4px;
  font-size: 20px;
}

.cell.revealed {
  background-color: #eee;
  cursor: default;
}

.cell.mine {
  background-color: red;
}

.cell.flag {
  color: red;
}
#specialMessage {
  margin-top: 10px;
  font-size: 22px;
  font-weight: bold;
  color: red;
  text-align: center;
  display: none;
}
</style>
</head>
<body>

<h1>Minesweeper 9x9</h1>
<div id="header">
  <div id="minesLeft">Mines: 10</div>
  <div id="reset">ðŸ˜Š</div>
  <div id="timer">0s</div>
</div>
<div id="board"></div>
<div id="specialMessage"></div>

<script>
const boardSize = 9;
const mineCount = 10;
let board = [];
let revealedCount = 0;
let flagsCount = 0;
let startTid = null;
let timerInterval = null;

const boardEl = document.getElementById("board");
const minesLeftEl = document.getElementById("minesLeft");
const timerEl = document.getElementById("timer");
const resetBtn = document.getElementById("reset");
const msgEl = document.getElementById("specialMessage");
const grÃ¤ns = 30;

function initGame(){
  boardEl.innerHTML = '';
  msgEl.style.display = "none";
  revealedCount = 0;
  flagsCount = 0;
  startTid = null;
  clearInterval(timerInterval);
  timerEl.innerText = "0s";
  minesLeftEl.innerText = `Mines: ${mineCount}`;

  board = [];
  for (let i=0;i<boardSize;i++){
    board[i] = [];
    for (let j=0;j<boardSize;j++){
      board[i][j] = {mine:false,revealed:false,flag:false};
      const cellEl = document.createElement("div");
      cellEl.classList.add("cell");
      cellEl.dataset.row = i;
      cellEl.dataset.col = j;
      cellEl.addEventListener("click", ()=>revealCell(i,j,cellEl));
      cellEl.addEventListener("contextmenu", (e)=>toggleFlag(e,i,j,cellEl));
      boardEl.appendChild(cellEl);
    }
  }

  // Placera minor slumpmÃ¤ssigt
  let placed = 0;
  while(placed < mineCount){
    const r = Math.floor(Math.random()*boardSize);
    const c = Math.floor(Math.random()*boardSize);
    if(!board[r][c].mine){
      board[r][c].mine = true;
      placed++;
    }
  }
}

function startTimer(){
  if(startTid) return;
  startTid = Date.now();
  timerInterval = setInterval(()=>{
    const tid = Math.floor((Date.now()-startTid)/1000);
    timerEl.innerText = `${tid}s`;
  },1000);
}

function toggleFlag(e,row,col,el){
  e.preventDefault();
  startTimer();
  const cell = board[row][col];
  if(cell.revealed) return;
  cell.flag = !cell.flag;
  el.innerText = cell.flag ? "ðŸš©" : "";
  el.classList.toggle("flag", cell.flag);
  flagsCount += cell.flag ? 1 : -1;
  minesLeftEl.innerText = `Mines: ${mineCount - flagsCount}`;
}

function revealCell(row,col,el){
  startTimer();
  const cell = board[row][col];
  if(cell.revealed || cell.flag) return;

  cell.revealed = true;
  el.classList.add("revealed");

  if(cell.mine){
    el.innerText = "ðŸ’£";
    el.classList.add("mine");
    endGame(false);
    return;
  }

  const count = countMines(row,col);
  el.innerText = count>0 ? count : "";
  revealedCount++;

  if(count===0){
    for(let r=row-1;r<=row+1;r++){
      for(let c=col-1;c<=col+1;c++){
        if(r>=0 && r<boardSize && c>=0 && c<boardSize){
          const neighborEl = boardEl.querySelector(`.cell[data-row="${r}"][data-col="${c}"]`);
          revealCell(r,c,neighborEl);
        }
      }
    }
  }

  if(revealedCount === boardSize*boardSize - mineCount){
    endGame(true);
  }
}

function countMines(row,col){
  let count=0;
  for(let r=row-1;r<=row+1;r++){
    for(let c=col-1;c<=col+1;c++){
      if(r>=0 && r<boardSize && c>=0 && c<boardSize){
        if(board[r][c].mine) count++;
      }
    }
  }
  return count;
}



function endGame(won){
  clearInterval(timerInterval);

  for(let i=0;i<boardSize;i++){
    for(let j=0;j<boardSize;j++){
      const cell = board[i][j];
      const el = boardEl.querySelector(`.cell[data-row="${i}"][data-col="${j}"]`);

      if(won){
        // Vid vinst: visa flaggor, men behÃ¥ll allt som redan avslÃ¶jats
        if(!cell.revealed && cell.flag){
          el.innerText = "ðŸš©";
          el.classList.add("revealed","flag");
        }
        // Ingen annan Ã¤ndring â€“ alla avslÃ¶jade siffror/tomma rutor fÃ¶rblir som de Ã¤r
      } else {
        // Vid fÃ¶rlust: avslÃ¶ja alla minor
        if(cell.mine){
          el.innerText = "ðŸ’£";
          el.classList.add("revealed","mine");
        }
      }
    }
  }

  const sluttid = startTid ? (Date.now()-startTid)/1000 : 0;
  msgEl.style.display = "block";
  if(won){
    if(sluttid <= grÃ¤ns){
      msgEl.innerText = `ðŸ”¥ Otroligt! Ni klarade det pÃ¥ ${sluttid.toFixed(1)} sekunder!\nLÃ¶senordet Ã¤r: polkagris`;
    } else {
      msgEl.innerText = `Bra jobbat! Tiden blev ${sluttid.toFixed(1)} sekunder.`;
    }
  } else {
    msgEl.innerText = `ðŸ’¥ Boom! Du trÃ¤ffade en mina!`;
  }
}



resetBtn.addEventListener("click", initGame);

initGame();
</script>
</body>
</html>
